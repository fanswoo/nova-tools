<script>
export default {
  el: '.content',
  mounted: function () {
    $('[data-toggle="popover"]').popover({
      html: true,
      trigger: 'hover',
      placement: 'top',
    });
    // this.changeCartsPriceTotal();
  },
  data: {
    Inquiry: Json.Inquiry,
    processing: false,
  },
  watch: {},
  methods: {
    changeCartAmount: function (key) {
      var _this = this;
      _this.processing = true;

      if (
        isNaN(this.Inquiry.InquiryItems[key].amount) ||
        this.Inquiry.InquiryItems[key].amount < 1
      ) {
        //防止前台填入負值或是非數字字元
        this.Inquiry.InquiryItems[key].amount = 1;
      }

      if (
        this.Inquiry.InquiryItems[key].Product.inquiryLowerLimit > 0 &&
        this.Inquiry.InquiryItems[key].amount <
          this.Inquiry.InquiryItems[key].Product.inquiryLowerLimit
      ) {
        this.Inquiry.InquiryItems[key].amount =
          this.Inquiry.InquiryItems[key].Product.inquiryLowerLimit;
      }

      if (
        this.Inquiry.InquiryItems[key].Product.inquiryUpperLimit > 0 &&
        this.Inquiry.InquiryItems[key].amount >
          this.Inquiry.InquiryItems[key].Product.inquiryUpperLimit
      ) {
        this.Inquiry.InquiryItems[key].amount =
          this.Inquiry.InquiryItems[key].Product.inquiryUpperLimit;
      }

      $.ajax({
        url: 'shop/inquiry/cart/changeCartAmount',
        type: 'POST',
        data: {
          cartId: this.Inquiry.InquiryItems[key].id,
          amount: this.Inquiry.InquiryItems[key].amount,
          inquiryId: this.Inquiry.id,
        },
        dataType: 'json',
      })
        .done(function (response) {
          // _this.Inquiry.isFreeFreight = response.isFreeFreight;
          // _this.Inquiry.tradeinCount = response.tradeinCount;
          // _this.Inquiry.payCartPriceTotal = response.payCartPriceTotal;
          // _this.Inquiry.Gifts = response.gifts;
          // _this.changeInquiryItemsPriceTotal();
          _this.processing = false;
        })
        .fail(function (response) {
          _this.processing = false;
        });
    },
  },
};
</script>
