import '@fanswoo/core/bootstrap/bootstrap';
import '@fanswoo/core/libraries/jquery/form';

import { Middleware } from '@fanswoo/controller/main';
import { Message } from '@fanswoo/message/main';

export default class BaseMiddleware extends Middleware {
  handle(): void {
    $.ajaxSetup({
      headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content'),
      },
    });

    const message = Message.getInstance();

    if (Json.frameworkEmbedMode) {
      message.show({
        text: '您已開啟 framework embed mode<br>開發完成應執行『php ff framework:update』<br>避免未更新 framework 就執行 git push 動作',
        second: 600,
      });
    }

    if (Json.frameworkIsTesting) {
      message.show({
        text: '目前主機正在執行自動測試程序<br>這段期間執行的所有操作將會被進行回溯',
        second: 600,
      });
    }
  }
}
