y
<template>
  <div>
    <div class="line-content">
      <div class="title">代碼模式</div>
      <div class="field">
        <select name="codeMode" v-model="codeMode" v-on:change="checkcodeMode">
          >
          <option value="1">連結即贈送</option>
          <option value="2">購買即贈送</option>
        </select>
      </div>
    </div>
    <div class="line-content">
      <div class="title">優惠類型</div>
      <div class="field">
        <select name="discountCodeType" v-model="discountCodeType">
          <option value="coupon" v-if="hasUserCoupon">贈送點數</option>
          <option value="gift" v-if="hasUserGift && codeMode == '2'">
            贈送贈品
          </option>
        </select>
      </div>
    </div>
    <div class="line-content">
      <div class="title">
        優惠內容( {{ discountCodeTypeText[discountCodeType] }} )
      </div>
      <div class="field">
        <template v-if="discountCodeType == 'coupon' && hasUserCoupon">
          <input
            type="number"
            name="coupon"
            style="width: 80px"
            value="1"
            v-model.number="coupon"
            v-on:change="checkCoupon"
          />
        </template>
        <template v-else-if="discountCodeType == 'gift' && hasUserGift">
          <many-quick-search
            v-bind:input-name="'giftName[]'"
            v-bind:search-input-name="'giftNameSearch'"
            v-bind:input-placeholder="'請輸入搜尋內容 ...'"
            v-bind:url="giftNamesQuickSearchLink"
            v-bind:search-only-match="'TRUE'"
          ></many-quick-search>
        </template>
      </div>
    </div>
  </div>
</template>

<script>
import ManyQuickSearchVue from '@fanswoo/core/vue/quick-search/many-quick-search.vue';

export default {
  props: ['data'],
  data: () => {
    return {
      giftNamesQuickSearchLink: '',
      discountCodeType: null,
      coupon: 0,
      codeMode: '1',
      discountCodeTypeText: {
        coupon: '點數',
        gift: '贈品',
      },
    };
  },
  components: {
    manyQuickSearch: ManyQuickSearchVue,
  },
  methods: {
    nl2br(str, is_xhtml) {
      if (typeof str === 'undefined' || str === null) {
        return '';
      }
      var breakTag =
        is_xhtml || typeof is_xhtml === 'undefined' ? '<br />' : '<br>';
      return (str + '').replace(
        /([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,
        '$1' + breakTag + '$2',
      );
    },
    checkCoupon: function () {
      if (this.coupon < 0) {
        this.coupon = 0;
      }
    },
    checkcodeMode: function () {
      if (this.codeMode == 'coupon') {
        this.coupon = 0;
      }
    },
  },
  computed: {
    datas() {
      return this.data;
    },
    discountCodeGifts() {
      return this.datas.discountCodeGifts;
    },
    quickSearchLink() {
      return this.datas.quickSearchLink;
    },
    hasUserCoupon() {
      return this.datas.hasUserCoupon;
    },
    hasUserGift() {
      return this.datas.hasUserGift;
    },
    // InquiryComments() {
    //     return this.datas.InquiryComments;
    // }
  },
  mounted() {
    this.discountCodeType = this.datas.discountCodeType || 'coupon';
    this.giftNamesQuickSearchLink =
      this.quickSearchLink.giftNamesQuickSearchLink;
  },
};
</script>
