<template>
  <div>
    <div
      v-for="(specificationColor, index) in specificationColors"
      :key="specificationColor.colorId"
      class="specification-colors"
    >
      <input
        type="text"
        placeholder="型別名稱"
        :value="specificationColor.colorName"
        @input="changeColorName($event, index)"
      />
      <input
        type="text"
        :style="{ background: specificationColor.colorRgb }"
        class="hueb-color"
        placeholder="#FFFFFF"
        :value="specificationColor.colorRgb"
        @input="
          $emit('alterSpecificationColor', {
            index,
            field: 'colorRgb',
            value: $event.target.value,
          })
        "
      />
    </div>
  </div>
</template>

<script setup lang="ts">
import 'huebee/huebee.css';
import Huebee from 'huebee';
import { onMounted, onUpdated, nextTick, getCurrentInstance } from 'vue';
import { useStore } from '@/control-center/store/control-center-store';
import SpecificationColor from '@fanswoo/control-center/pages/admin/custom-component/edit-control-center/line-content/shop/product/product/classes/specification-color';
import _ from 'lodash';

const props = defineProps({
  specificationColors: {
    type: Array,
    default: () => [],
  }
});

const store = useStore();
const emit = defineEmits(['alterSpecificationColor']);

function changeColorName(event, index) {
  _.debounce(() => {
    emit('alterSpecificationColor', {
      index,
      field: 'colorName',
      value: event.target.value,
    });
  }, 500)();
}

function bindHuebee() {
  $('.hueb-color:not([bind-hueb-color])').each((key, element) => {
    $(element).attr('bind-hueb-color', 'true');
    const hueb = new Huebee(element, {
      notation: 'hex',
      saturations: 2,
    });

    hueb.on('change', function (this: Huebee, color) {
      const index = $(this.setTextElems[0])
        .parent('.specification-colors')
        .index();

      emit('alterSpecificationColor', {
        index,
        field: 'colorRgb',
        value: color,
      });

      this.close();
    });
  });
}

onMounted(() => {
  nextTick(() => {
    bindHuebee();
  });
});

onUpdated(() => {
  nextTick(() => {
    bindHuebee();
  });
});

store.commit('ProductSpecification/setSpecificationColors', props.specificationColors);
</script>

<style lang="scss" scoped>
input.hueb-color {
  width: 20px;
  transition: background 1s, width 0.3s;
  &:focus,
  &:hover {
    width: 75px;
    border-color: #ccc;
  }
}
</style>