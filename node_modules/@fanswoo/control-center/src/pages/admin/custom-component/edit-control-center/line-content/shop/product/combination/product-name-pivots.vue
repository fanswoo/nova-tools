<template>
  <div>
    <div
      v-cloak
      :key="productName"
      class="line-content"
      v-for="(productName, key) in productNamesArr"
      v-bind:lineContent="'productNamePivotsSearch' + key"
    >
      <template v-if="productName">
        <div class="title">
          {{ productName }}
        </div>
        <div class="field">
          <many-quick-search
            v-if="combinationProducts[key]"
            v-bind:input-name="'productNamePivots' + key + '[]'"
            v-bind:search-input-name="'productNamePivotsSearch' + key"
            v-bind:input-placeholder="'請輸入搜尋內容 ...'"
            v-bind:url="productNamePivotQuickSearchLink"
            v-bind:search-only-match="'TRUE'"
            v-bind:select-items="combinationProducts[key].selectItems"
            v-bind:only-display="true"
          ></many-quick-search>
          <many-quick-search
            v-else
            v-bind:input-name="'productNamePivots' + key + '[]'"
            v-bind:search-input-name="'productNamePivotsSearch' + key"
            v-bind:input-placeholder="'請輸入搜尋內容 ...'"
            v-bind:url="productNamePivotQuickSearchLink"
            v-bind:search-only-match="'TRUE'"
          ></many-quick-search>
          <div class="explanation" v-if="requestId">
            {{
              productName
            }}包含以上產品，若使用者之購物車消費以上產品則達到此產品系統之條件
          </div>
          <div class="explanation" v-else>
            請填寫{{
              productName
            }}包含哪些產品，若使用者之購物車消費以上產品則達到此產品系統之條件，同樣的產品不得重複屬於不同的銷售組合中
          </div>
        </div>
      </template>
    </div>
  </div>
</template>

<script>
import ManyQuickSearchVue from '@fanswoo/core/vue/quick-search/many-quick-search.vue';
import EventBus from '@fanswoo/core/bootstrap/event-bus';

export default {
  props: ['requestId', 'combinationProducts', 'quickSearchLink'],
  data: () => {
    return {
      productNames: '',
      productNamePivotQuickSearchLink: '',
    };
  },
  components: {
    manyQuickSearch: ManyQuickSearchVue,
  },
  methods: {},
  computed: {
    productNamesArr: function () {
      return this.productNames.split(/\s+/);
    },
  },
  mounted() {
    this.productNamePivotQuickSearchLink =
      this.quickSearchLink.productNamePivotQuickSearchLink;

    for (let key in this.combinationProducts) {
      this.productNames += this.combinationProducts[key].name + '\n';
    }

    EventBus.$emit('initProductNames', this.productNames);

    EventBus.$on('changeProductNames', (productNames) => {
      this.productNames = productNames;
    });
  },
  beforeDestroy() {
    EventBus.$off();
  },
};
</script>
