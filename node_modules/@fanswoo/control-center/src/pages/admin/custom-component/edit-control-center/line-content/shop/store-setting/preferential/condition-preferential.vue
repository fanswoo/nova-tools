<template>
  <div>
    <div class="line-content" linecontent="conditionType">
      <div class="title">優惠條件</div>
      <div class="field">
        <select :disabled="locked" name="conditionType" v-model="conditionType">
          <option
            v-for="option in conditionTypeOptions"
            :value="option.value"
            :key="option.id"
          >
            {{ option.text }}
          </option>
        </select>
      </div>
    </div>
    <div
      class="line-content"
      linecontent="conditionTypeDetail"
      v-if="hasConditionRule"
    >
      <div class="title">優惠規則</div>
      <div class="field">
        <select
          :disabled="locked"
          name="conditionTypeDetail"
          v-model="conditionTypeDetail"
        >
          <option
            v-for="option in conditionTypeDetailOptions"
            :value="option.value"
            :key="option.id"
          >
            {{ option.text }}
          </option>
        </select>
      </div>
    </div>
    <LineTitle
      title="優惠類型"
      text="請填寫使用者達成條件後可獲得之優惠"
    ></LineTitle>
    <div class="line-content" linecontent="giveType">
      <div class="title">優惠類型</div>
      <div class="field">
        <select :disabled="locked" name="giveType" v-model="giveType">
          <option
            v-for="option in giveTypeOptions"
            :value="option.value"
            :key="option.id"
          >
            {{ option.text }}
          </option>
        </select>
      </div>
    </div>
    <div class="line-content" linecontent="giveFor" v-if="isDiscountGiveType">
      <div class="title">套用至</div>
      <div class="field">
        <select :disabled="locked" name="giveFor" v-model="giveFor">
          <option
            v-for="option in giveForOptions"
            :value="option.value"
            :key="option.id"
          >
            {{ option.text }}
          </option>
        </select>
      </div>
    </div>
    <template>
      <LineTitle
        title="設定條件及優惠內容"
        text="請填寫使用者達成條件後可獲得之優惠"
      ></LineTitle>
      <div class="line-content" linecontent="giveAndCondition">
        <div class="title">條件及優惠內容</div>
        <div class="field">
          <div
            v-for="(conditionAndGivePair, index) in conditionAndGivePairs"
            :key="conditionAndGivePair.id"
            class="row mx-0 mb-1 condition-give-pair align-items-center"
          >
            <p class="condition-give-pair-title d-block d-md-none">
              優惠條件組合 {{ index + 1 }}
            </p>
            <div
              class="
                d-block d-md-flex
                align-items-center
                controls
                col-12 col-md-5 col-lg-4 col-xl-3
                px-0
                my-3
              "
            >
              <span>{{ giveTypeTitle }}&nbsp;</span>
              <div class="input-group pl-2">
                <input
                  class="form-control"
                  :disabled="locked"
                  type="number"
                  name="gives[]"
                  v-model.number.lazy="conditionAndGivePair.give"
                />
                <span class="input-group-text">{{ giveTypeText }}</span>
              </div>
            </div>
            <div class="d-none d-md-block d-lg-none col-1 px-0"></div>
            <div
              v-if="hasConditionRule"
              class="
                d-block d-md-flex
                align-items-center
                controls
                col-12 col-md-5 col-lg-4 col-xl-3
                px-0
                my-3
              "
            >
              <span>當購物滿&nbsp;</span>
              <div class="input-group pl-2">
                <input
                  class="form-control"
                  :disabled="locked"
                  type="number"
                  name="conditions[]"
                  v-model.number.lazy="conditionAndGivePair.condition"
                />
                <span class="input-group-text">{{
                  conditionTypeDetailText
                }}</span>
              </div>
            </div>
            <div class="col-12 col-md-1 px-0">
              <a
                v-if="index !== 0"
                href
                style="color: red"
                @click.prevent="removeNewConditionAndGivePair(index)"
                >刪除</a
              >
            </div>
            <div class="d-none d-lg-block col-lg-3 col-xl-5"></div>
            <PreferentialGiftSearcher
              v-if="isGiftGiveType"
              :index="index"
              :item-class="giftItemClass"
              :current-selected-items="[selectedGiftItems[index]]"
            />
          </div>
          <a
            href
            v-if="
              hasConditionRule &&
              conditionAndGivePairs.length < maxPairAmount &&
              !locked
            "
            @click.prevent="addNewConditionAndGivePair"
            >新增優惠條件</a
          >
        </div>
      </div>
    </template>
    <template v-if="isConditionTypeSpecificItem || isGiveForSpecificItem">
      <PreferentialItemSearcher
        :item-class="itemClass"
        :current-selected-items="selectedItems"
      />
    </template>
    <template v-if="isConditionTypeSpecificClass || isGiveForSpecificClass">
      <PreferentialClassSearcher
        :categories="categories"
        :item-class="itemClass"
        :current-selected-items="selectedExcludedItems"
      />
    </template>
    <LineTitle title="參考優惠文字" text></LineTitle>
    <div class="line-content" linecontent="giveType">
      <div class="title">優惠文字</div>
      <div
        class="field"
        style="padding-top: 10px; line-height: 20px !important"
      >
        <p
          v-for="conditionAndGivePair in conditionAndGivePairs"
          v-html="
            preferentialTemplateText(
              conditionAndGivePair.condition,
              conditionAndGivePair.give,
            )
          "
        ></p>
      </div>
      <input
        v-for="conditionAndGivePair in conditionAndGivePairs"
        type="hidden"
        name="preferentialTemplateTexts[]"
        :value="
          preferentialTemplateText(
            conditionAndGivePair.condition,
            conditionAndGivePair.give,
            true,
          )
        "
      />
    </div>
    <template>
      <LineTitle
        title="適用會員"
        text="請填寫使用者達成條件後可獲得之優惠"
      ></LineTitle>
      <div class="line-content use-once" linecontent="useOnce">
        <div class="title">優惠限用一次</div>
        <div class="field">
          <label data-toggle="tooltip" class="checkbox m-0 mt-2">
            <input
              type="radio"
              name="useOnce"
              v-model="useOnce"
              :value="0"
              :disabled="locked"
            />
            可使用無限次
          </label>
          <label data-toggle="tooltip" class="checkbox m-0 mt-2 ml-3">
            <input
              type="radio"
              name="useOnce"
              v-model="useOnce"
              :value="1"
              :disabled="locked"
            />
            只能使用一次
          </label>
        </div>
      </div>
      <div class="line-content" linecontent="forUser">
        <div class="title">適用會員</div>
        <div class="field">
          <label data-toggle="tooltip" class="checkbox m-0 mt-2">
            <input
              type="radio"
              name="forUser"
              v-model="forUser"
              :value="ForUser.ALL"
              :disabled="locked"
            />
            全部會員
          </label>
          <label data-toggle="tooltip" class="checkbox m-0 mt-2 ml-3">
            <input
              type="radio"
              name="forUser"
              v-model="forUser"
              :value="ForUser.SPECIFIC_USER_GROUP"
              :disabled="locked"
            />
            特定會員群組
          </label>
        </div>
      </div>
      <div
        class="line-content user-group-display"
        linecontent="userGroupDisplay"
        v-if="isForSpecificUserGroup"
      >
        <div class="title">適用會員群組</div>
        <div class="field">
          <ul class="user-list m-0 p-0">
            <li
              class="user-item mb-2"
              v-for="userGroup in userGroups"
              :key="userGroup.id"
            >
              <input
                type="checkbox"
                name="userGroupIds[]"
                class="cursor-pointer"
                :id="`user-group-${userGroup.id}`"
                :value="userGroup.id"
                :checked="currentUserGroupIds.indexOf(userGroup.id) !== -1"
                :disabled="locked"
              />
              <label
                class="my-0 ml-1 h6 cursor-pointer"
                :for="`user-group-${userGroup.id}`"
                >{{ userGroup.name }}</label
              >
            </li>
          </ul>
        </div>
      </div>
    </template>
    <template>
      <LineTitle
        title="促銷代碼"
        text="請填寫使用者達成條件後可獲得之優惠"
      ></LineTitle>
      <div class="line-content" linecontent="autoUse">
        <div class="title">自動套入優惠</div>
        <div class="field">
          <label data-toggle="tooltip" class="checkbox m-0 mt-2">
            <input
              type="radio"
              name="autoUse"
              v-model="autoUse"
              :value="1"
              :disabled="locked"
            />
            是
          </label>
          <label data-toggle="tooltip" class="checkbox m-0 mt-2 ml-3">
            <input
              type="radio"
              name="autoUse"
              v-model="autoUse"
              :value="0"
              :disabled="locked"
            />
            否
          </label>
        </div>
      </div>
      <div class="line-content" linecontent="discountCode" v-if="autoUse == 0">
        <div class="title">折扣代碼</div>
        <div class="field">
          <div
            v-for="(discountCode, index) in discountCodes"
            :key="discountCode.id"
            class="row mx-0 mb-1 condition-give-pair align-items-center"
          >
            <p class="condition-give-pair-title d-block d-md-none">
              折扣代碼 {{ index + 1 }}
            </p>
            <div
              class="
                d-block d-md-flex
                align-items-center
                controls
                col-12 col-md-5 col-lg-4 col-xl-3
                px-0
                my-3
              "
            >
              <span class="d-none d-md-block"
                >折扣代碼 {{ index + 1 }}&nbsp;</span
              >
              <div class="input-group pl-2">
                <input
                  class="form-control"
                  placeholder="例如：VIP85"
                  type="text"
                  name="discountCodes[]"
                  v-model="discountCode.code"
                  :disabled="locked"
                />
              </div>
            </div>
            <div class="col-12 col-md-1 px-0">
              <a
                v-if="index !== 0"
                href
                style="color: red"
                @click.prevent="removeNewDiscountCode(index)"
                >刪除</a
              >
            </div>
            <div class="d-none d-lg-block col-lg-3 col-xl-5"></div>
          </div>
          <a v-if="!locked" href @click.prevent="addNewDiscountCode"
            >新增折扣代碼</a
          >
        </div>
      </div>
      <div class="line-content">
        <div class="title">優惠可使用的次數</div>
        <div class="field">
          <div class="input-group col-12 col-md-3 p-0">
            <input
              class="form-control"
              type="number"
              name="usableTimes"
              v-model.lazy="usableTimes"
              :disabled="isUsableTimesInfinite || locked"
            />
            <span class="input-group-text">次</span>
          </div>
          <div class="input-group col-12 col-md-3 p-0">
            <label data-toggle="tooltip" class="checkbox m-0 mt-2">
              <input
                type="checkbox"
                name="isUsableTimesInfinite"
                v-model="isUsableTimesInfinite"
                :value="isUsableTimesInfinite"
                :disabled="locked"
              />
              不限使用次數
            </label>
          </div>
          <p class="explanation">請填寫優惠可使用的次數</p>
        </div>
      </div>
    </template>
  </div>
</template>

<script>
import EventBus from '@fanswoo/core/bootstrap/event-bus';
import { mapState, mapGetters } from 'vuex';

import {
  ConditionType,
  ConditionTypeDetail,
  GiveType,
  GiveFor,
  ForUser,
} from '@fanswoo/control-center/pages/admin/custom-component/edit-control-center/line-content/shop/store-setting/preferential/constants';

import PreferentialStore from '@fanswoo/control-center/pages/admin/custom-component/edit-control-center/line-content/shop/store-setting/preferential/preferential-store';

import LineTitle from '@fanswoo/control-center/custom-component/edit-control-center/line-content/base/line-title.vue';
import PreferentialItemSearcher from '@fanswoo/control-center/pages/admin/custom-component/edit-control-center/line-content/shop/store-setting/preferential/preferential-item-searcher.vue';
import PreferentialClassSearcher from '@fanswoo/control-center/pages/admin/custom-component/edit-control-center/line-content/shop/store-setting/preferential/preferential-class-searcher.vue';
import PreferentialGiftSearcher from '@fanswoo/control-center/pages/admin/custom-component/edit-control-center/line-content/shop/store-setting/preferential/preferential-gift-searcher.vue';

export default {
  store: PreferentialStore,
  components: {
    LineTitle,
    PreferentialItemSearcher,
    PreferentialClassSearcher,
    PreferentialGiftSearcher,
  },
  props: [
    'ormId',
    'currentConditionType',
    'currentConditionTypeDetail',
    'currentGiveType',
    'currentGiveFor',

    'currentConditionAndGivePairs',

    'selectedGiftItems',
    'selectedItems',
    'selectedExcludedItems',

    'currentForUser',
    'currentUseOnce',
    'userGroups',
    'currentUserGroupIds',

    'currentAutoUse',
    'currentUsableTimes',
    'currentDiscountCodes',
    'currentIsUsableTimesInfinite',

    'itemClass',
    'giftItemClass',

    'categories',
  ],
  data: () => {
    return {
      conditionAndGivePairs: [],
      giveMin: 0,
      giveMax: 0,
      discountCodes: [],

      useOnce: null,
      autoUse: null,
      usableTimes: 1,
      isUsableTimesInfinite: true,

      tag: 'span',
      props: [{ name: 'style', value: 'font-weight:bold' }],
    };
  },
  watch: {
    conditionType(value) {
      if (value == this.ConditionType.SPECIFIC_ITEM) {
        this.giveFor = this.GiveFor.SPECIFIC_ITEM;
      } else if (value == this.ConditionType.SPECIFIC_CLASS) {
        this.giveFor = this.GiveFor.SPECIFIC_CLASS;
      } else if (value == this.ConditionType.ALL) {
        this.giveFor = this.GiveFor.ALL;
      } else if (
        value == this.ConditionType.UNCONDITIONAL ||
        value == this.ConditionType.FISRT_PURCHASE
      ) {
        if (this.currentConditionAndGivePairs.length > 0) {
          this.conditionAndGivePairs = [this.currentConditionAndGivePairs[0]];
        } else {
          this.conditionAndGivePairs = [
            {
              id: this.makeId(12),
              condition: null,
              give: null,
            },
          ];
        }

        this.giveFor = this.GiveFor.ALL;
      }
    },
    usableTimes(value) {
      if (value < 1) {
        this.usableTimes = 1;
      }
    },
    conditionAndGivePairs: {
      handler: function (value, oldValue) {
        for (let conditionAndGivePair of this.conditionAndGivePairs) {
          let give = parseInt(conditionAndGivePair.give);
          give = isNaN(give) ? 0 : give;

          if (give < this.giveMin) {
            give = this.giveMin;
          }

          if (this.giveMax !== null && give > this.giveMax) {
            give = this.giveMax;
          }

          conditionAndGivePair.give = give;

          let condition = parseInt(conditionAndGivePair.condition);

          if (condition < 1) {
            condition = 1;
          }

          conditionAndGivePair.condition = condition;
        }
      },
      deep: true,
    },
  },
  computed: {
    conditionType: {
      get() {
        return this.$store.state.conditionType;
      },
      set(value) {
        this.$store.commit('setConditionType', value);
      },
    },
    conditionTypeDetail: {
      get() {
        return this.$store.state.conditionTypeDetail;
      },
      set(value) {
        this.$store.commit('setConditionTypeDetail', value);
      },
    },
    giveType: {
      get() {
        return this.$store.state.giveType;
      },
      set(value) {
        this.$store.commit('setGiveType', value);

        if (
          this.conditionType != this.ConditionType.SPECIFIC_CLASS &&
          this.conditionType != this.ConditionType.SPECIFIC_ITEM
        ) {
          if (value != this.GiveType.MONEY && value != this.GiveType.DISCOUNT) {
            this.$store.commit('setGiveFor', this.GiveFor.ALL);
          }
        }

        switch (value) {
          case this.GiveType.DISCOUNT:
            this.giveMin = 0;
            this.giveMax = 100;
            break;
          case this.GiveType.MONEY:
          case this.GiveType.COUPON:
          case this.GiveType.SHIPPING:
            this.giveMin = 0;
            this.giveMax = null;
            break;
          case this.GiveType.GIFT:
            this.giveMin = 1;
            this.giveMax = null;
            break;
        }

        this.handelConditionAndGivePairs();
      },
    },
    giveFor: {
      get() {
        return this.$store.state.giveFor;
      },
      set(value) {
        this.$store.commit('setGiveFor', value);
      },
    },
    forUser: {
      get() {
        return this.$store.state.forUser;
      },
      set(value) {
        this.$store.commit('setForUser', value);
      },
    },
    locked() {
      return this.ormId !== null && this.ormId > 0;
    },
    // preferentialText() {

    // },
    ...mapState([
      'ConditionType',
      'ConditionTypeDetail',
      'GiveType',
      'GiveFor',
      'ForUser',

      'maxPairAmount',
    ]),
    ...mapGetters([
      'conditionTypeOptions',
      'conditionTypeDetailOptions',
      'giveTypeOptions',
      'giveForOptions',
      'isDiscountGiveType',
      'isGiftGiveType',
      'isShippingGiveType',
      'isConditionTypeSpecificItem',
      'isConditionTypeSpecificClass',
      'isGiveForSpecificItem',
      'isGiveForSpecificClass',
      'hasConditionRule',
      'isForSpecificUserGroup',
      'conditionTypeDetailText',
      'giveTypeTitle',
      'giveTypeText',
      'preferentialText',
    ]),
  },
  methods: {
    conditionTypeTemplateText(hasReplacer = false) {
      let tag = this.tag;
      let props = this.props;

      switch (this.conditionType) {
        case this.ConditionType.UNCONDITIONAL:
          return ''; //return this.createHtmlTemplate(tag, "全店", props).outerHTML;
          break;
        case this.ConditionType.FISRT_PURCHASE:
          return '[會員首次購物]'; //return this.createHtmlTemplate(tag, "會員首次購物", props).outerHTML;
          break;
        case this.ConditionType.ORDER:
          return '[全單]';
          // return `${
          //   this.createHtmlTemplate(tag, "全單", props).outerHTML
          // } 購買`;
          break;
        case this.ConditionType.SPECIFIC_ITEM:
          return `購買 [指定產品${hasReplacer ? '((discountableItems))' : ''}]`;
          // `購買 ${
          //   this.createHtmlTemplate(
          //     tag,
          //     `指定產品${hasReplacer ? "((discountableItems))" : ""}`,
          //     props
          //   ).outerHTML
          // }`;
          break;
        case this.ConditionType.SPECIFIC_CLASS:
          return `購買 [指定分類${
            hasReplacer ? '((categories))((excludedDiscountableItems))' : ''
          }]`;
          // return `購買 ${
          //   this.createHtmlTemplate(
          //     tag,
          //     `指定分類${
          //       hasReplacer ? "((categories))((excludedDiscountableItems))" : ""
          //     }`,
          //     props
          //   ).outerHTML
          // } 的產品`;
          break;
      }
    },
    conditionTypeDetailTemplateText(condition) {
      let tag = this.tag;
      let props = this.props;
      let fill = condition || '__';

      if (
        this.conditionType == ConditionType.UNCONDITIONAL ||
        this.conditionType == ConditionType.FISRT_PURCHASE
      ) {
        return '';
      }

      switch (this.conditionTypeDetail) {
        case ConditionTypeDetail.MONEY:
          return `[滿 ${fill} 元]`;
          // return this.createHtmlTemplate(tag, `滿 ${fill} 元`, props).outerHTML;
          break;
        case ConditionTypeDetail.COUNT:
          return `[滿 ${fill} 件]`;
          // return this.createHtmlTemplate(tag, `滿 ${fill} 件`, props).outerHTML;
          break;
      }
    },
    giveTypeTemplateText(give, hasReplacer = false) {
      let tag = this.tag;
      let props = this.props;
      let fill =
        give === null || give === undefined || give === '' ? '__' : give;

      switch (this.giveType) {
        case GiveType.DISCOUNT:
          fill = fill === '__' ? '__' : fill / 10;
          return `即享 [${fill} 折]`;
          // return `即享 ${
          //   this.createHtmlTemplate(tag, `${fill} 折`, props).outerHTML
          // }`;
          break;
        case GiveType.MONEY:
          return `即折扣 [${fill} 元]`;
          // return `即折扣 ${
          //   this.createHtmlTemplate(tag, `${fill} 元`, props).outerHTML
          // }`;
          break;
        case GiveType.COUPON:
          return `即贈 [${fill} 點]`;
          // return `即贈 ${
          //   this.createHtmlTemplate(tag, `${fill} 點`, props).outerHTML
          // }`;
          break;
        case GiveType.GIFT:
          return `即獲得 [${fill} 件贈品${hasReplacer ? '((gifts))' : ''}]`;
          // return `即獲得 ${
          //   this.createHtmlTemplate(
          //     tag,
          //     `${fill} 件贈品${hasReplacer ? "((gifts))" : ""}`,
          //     props
          //   ).outerHTML
          // }`;
          break;
        case GiveType.SHIPPING:
          return `即享 [${fill} 元運費]`;
          // return `即享 ${
          //   this.createHtmlTemplate(tag, `${fill} 元運費`, props).outerHTML
          // }`;
          break;
      }
    },
    giveForTemplateText() {
      let tag = this.tag;
      let props = this.props;

      if (
        this.giveType != GiveType.DISCOUNT &&
        this.giveType != GiveType.MONEY
      ) {
        return '';
      }

      switch (this.giveFor) {
        case GiveFor.ALL:
          return `[全產品]`;
          // return this.createHtmlTemplate(tag, "全產品", props).outerHTML;
          break;
        case GiveFor.SPECIFIC_ITEM:
          return `[指定產品]`;
          // return this.createHtmlTemplate(tag, "指定產品", props).outerHTML;
          break;
        case GiveFor.SPECIFIC_CLASS:
          return `[指定分類]`;
          // return this.createHtmlTemplate(tag, "指定分類", props).outerHTML;
          break;
      }
    },
    preferentialTemplateText(condition, give, hasReplacer = false) {
      let conditionTypeTemplateText =
        this.conditionTypeTemplateText(hasReplacer);
      let conditionTypeDetailTemplateText =
        this.conditionTypeDetailTemplateText(condition);
      let giveForTemplateText = this.giveForTemplateText();
      let giveTypeTemplateText = this.giveTypeTemplateText(give, hasReplacer);

      let head =
        `${conditionTypeTemplateText} ${conditionTypeDetailTemplateText}`.trim();
      let separate =
        conditionTypeTemplateText || conditionTypeDetailTemplateText
          ? '，'
          : ' ';
      let tail = `${giveForTemplateText} ${giveTypeTemplateText}`.trim();

      return `${head}${separate}${tail}`.trim();
    },
    createHtmlTemplate(tag, text, props) {
      let html = document.createElement(tag);
      let content = document.createTextNode(text);
      html.appendChild(content); //add the text node to the newly created div.

      for (let prop of props) {
        html.setAttribute(prop.name, prop.value);
      }

      return html;
    },
    handelConditionAndGivePairs() {
      for (let conditionAndGivePair of this.conditionAndGivePairs) {
        let give = parseInt(conditionAndGivePair.give);

        if (give < this.giveMin) {
          give = this.giveMin;
        }

        if (this.giveMax !== null && give > this.giveMax) {
          give = this.giveMax;
        }

        conditionAndGivePair.give = give;

        let condition = parseInt(conditionAndGivePair.condition);

        if (condition < 0) {
          condition = 0;
        }

        conditionAndGivePair.condition = condition;
      }
    },
    changeGive(event, index) {
      let value = parseInt(event.target.value);

      if (this.giveMin !== null && value < this.giveMin) {
        value = this.giveMin;
      }

      if (value > this.giveMax) {
        value = this.giveMax;
      }

      this.conditionAndGivePairs[index].give = value;
      // conditionAndGivePair.give = value;
      console.log(
        value,
        this.giveMin,
        this.giveMax,
        this.conditionAndGivePairs[index].give,
      );
    },
    addNewConditionAndGivePair() {
      if (this.conditionAndGivePairs.length == this.maxPairAmount) {
        alert(`最多只能新增 ${this.maxPairAmount} 個優惠條件組合`);
        return;
      }

      this.conditionAndGivePairs.push({
        id: this.makeId(12),
        condition: null,
        give: null,
      });
    },
    removeNewConditionAndGivePair(index) {
      if (this.conditionAndGivePairs.length == 1) {
        alert('至少要有 1 個優惠條件組合');
        return;
      }

      this.conditionAndGivePairs.splice(index, 1);
    },
    addNewDiscountCode() {
      this.discountCodes.push({
        id: this.makeId(12),
        code: '',
      });
    },
    removeNewDiscountCode(index) {
      if (this.discountCodes.length == 1) {
        alert('至少要有 1 個折扣碼填寫的欄位');
        return;
      }

      this.discountCodes.splice(index, 1);
    },
    makeId(length) {
      var result = '';
      var characters =
        'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      var charactersLength = characters.length;
      for (var i = 0; i < length; i++) {
        result += characters.charAt(
          Math.floor(Math.random() * charactersLength),
        );
      }
      return result;
    },
    initData() {
      this.$store.commit(
        'setConditionType',
        this.currentConditionType || ConditionType.UNCONDITIONAL, //ConditionType.SPECIFIC_CLASS
      );
      this.$store.commit(
        'setConditionTypeDetail',
        this.currentConditionTypeDetail || ConditionTypeDetail.MONEY,
      );
      // this.$store.commit(
      //   "setGiveType",
      //   this.currentGiveType || GiveType.DISCOUNT
      // );
      this.giveType = this.currentGiveType || GiveType.DISCOUNT;
      this.$store.commit('setGiveFor', this.currentGiveFor || GiveFor.ALL);

      if (this.currentConditionAndGivePairs.length > 0) {
        this.conditionAndGivePairs = this.currentConditionAndGivePairs;
      } else {
        this.conditionAndGivePairs.push({
          id: this.makeId(12),
          condition: null,
          give: null,
        });
      }

      this.useOnce =
        this.currentUseOnce === null
          ? this.autoUse
          : this.currentUseOnce
          ? 1
          : 0;
      this.$store.commit('setForUser', this.currentForUser || ForUser.ALL);

      this.autoUse =
        this.currentAutoUse === null
          ? this.autoUse
          : this.currentAutoUse
          ? 1
          : 0;
      this.usableTimes = this.currentUsableTimes || 1;

      if (this.currentDiscountCodes.length > 0) {
        this.discountCodes = this.currentDiscountCodes;
      } else {
        this.discountCodes.push({
          id: this.makeId(12),
          code: null,
        });
      }

      this.isUsableTimesInfinite = this.currentIsUsableTimesInfinite;
    },
  },
  mounted() {
    this.initData();
    // console.log(this.selectedGiftItems);
  },
  beforeDestroy() {
    EventBus.$off();
  },
};
</script>

<style scoped lang="scss">
.edit-content .line-content .field {
  line-height: 1 !important;
}

.condition-give-pair {
  @media (max-width: 767px) {
    padding-top: 15px;
    padding-bottom: 15px;
    // border-top: 1px solid #ccc;
    border-bottom: 1px solid #ccc;
  }
}

.edit-content .line-content .field input[type='text'],
.edit-content .line-content .field input[type='number'],
.edit-content .line-content .field input[type='password'] {
  flex: 1;
  width: unset;
}

// .edit-content .lineContent .field select {
//   height: 30px;
//   margin: 0;
// }

.condition-give-pair .input-group {
  width: 75%;
  @media (max-width: 767px) {
    width: 100%;
    padding: 0 !important;
    margin-top: 0.5rem !important;
  }
}

.btn {
  border: 1px solid #ccc;
}

.user-list {
  list-style: none;
}

.user-list .user-item {
  display: flex;
  align-items: center;
}
</style>
