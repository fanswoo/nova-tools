<template>
  <span>
    <input
      ref="input"
      :name="inputName"
      type="text"
      :value="value"
      :style="cssStyle"
      :maxlength="inputMaxlength ? inputMaxlength : null"
      @keyup="changeInputWidth"
      @change="onORMCollectionUpdate"
    />
  </span>
</template>

<script setup lang="ts">
import { ref, onMounted, watch, toRef } from 'vue';
import ff from '@fanswoo/core/utils/helper';

interface ICssStyle {
  width: string;
}

const emit = defineEmits(['onORMCollectionUpdate']);

const props = defineProps({
  inputName: {
    type: String,
    default: '',
  },
  value: {
    type: String,
    default: '',
  },
  inputMaxlength: {
    type: Number,
    default: 0,
  },
});

let cssStyle: ICssStyle = ref({
  width: '',
});

let input = ref<HTMLButtonElement | null>(null);

const changeInputWidth = (event: Event) => {
  const target = event.currentTarget as HTMLInputElement;
  if (input.value && target.value) {
    input.value.style.width = `${ff.inputValueToWidth(target.value)}px`;
  }
};

const onORMCollectionUpdate = (event:Event) => {
  emit('onORMCollectionUpdate', {
    target: event.currentTarget,
  });
};

watch(toRef(props, 'value'), (newValue: string) => {
  cssStyle.value.width = newValue ? `${ff.inputValueToWidth(newValue)}px` : 'auto';
}, { deep: true });

onMounted(() => {
  cssStyle.value.width = props.value ? `${ff.inputValueToWidth(props.value)}px` : 'auto';
});
</script>
