<template>
  <span>
    {{ beforeText }}
    <input
      ref="input"
      :name="inputName"
      type="number"
      :class="{
        'hide-arrow': hideArrow,
      }"
      :value="value"
      :style="cssStyle"
      :min="inputMin ? inputMin : null"
      :max="inputMax ? inputMax : null"
      @keyup="changeInputWidth"
      @change="onORMCollectionUpdate"
    />
  </span>
</template>

<script setup lang="ts">
import { ref, watch, onMounted, getCurrentInstance } from 'vue';
import ff from '@fanswoo/core/utils/helper';

const emit = defineEmits(['onORMCollectionUpdate']);

// Props
const props = defineProps({
  inputName: {
    type: String,
    default: ''
  },
  value: {
    type: Number,
    default: 0
  },
  inputMin: {
    type: Number,
    default: 0
  },
  inputMax: {
    type: Number,
    default: 99999999
  },
  borderColor: {
    type: String,
    default: ''
  },
  borderStyle: {
    type: String,
    default: ''
  },
  beforeText: {
    type: String,
    default: ''
  },
  hideArrow: {
    type: Boolean,
    default: false
  },
});

const input = ref<HTMLButtonElement>();
const cssStyle = ref({
  width: '',
  'border-color': '',
  'border-style': ''
});

// Methods
const changeInputWidth = (event) => {
  input.value.style.width = `${ff.inputValueToWidth(event.currentTarget.value)}px`;
}

const onORMCollectionUpdate = (event) => {
  emit('onORMCollectionUpdate', {
    target: event.currentTarget,
  });
}

// Watchers
watch(() => props.value, (val) => {
  input.value.style.width = `${ff.inputValueToWidth(val.toString())}px`;
}, {
  deep: true
});

onMounted(() => {
  cssStyle.value = {
    width: `${ff.inputValueToWidth(props.value.toString())}px`,
    'border-color': props.borderColor,
    'border-style': props.borderStyle,
  };
});
</script>
