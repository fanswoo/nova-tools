<template>
  <span>
    <button class="a" :name="name" @click.prevent="click()">
      <FontAwesomeIcon icon="trash" />
    </button>
  </span>
</template>

<script setup lang="ts">
import { useStore } from '@/control-center/store/control-center-store';
import { Message } from '@fanswoo/message/main';

const props = defineProps({
  title: {
    type: String,
    default: '',
  },
  fontAwesomeIcon: {
    type: String,
    default: '',
  },
  name: {
    type: String,
    default: 'id',
  },
  value: {
    type: [String, Number],
    default: 0,
  },
  action: {
    type: String,
    default: '',
  },
  confirm: {
    type: String,
    default: '',
  },
});

const store = useStore();
const setSyncORMs = (state) => store.commit('RoutePage/setSyncORMs', state);

let click = async () => {
  let response;
  const postData = {};
  postData[props.name] = props.value;
  if (!window.confirm(props.confirm)) {
    return false;
  }
  try {
    response = await axios.post(props.action, postData);
  } catch (error) {
    console.warn(error);
  }
  const { data } = response;
  const message = Message.getInstance();
  message.show({
    text: data.text,
    second: data.second,
    downloadUrl: data.downloadUrl,
  });
  if (data.syncORMs && data.syncORMs.ids && data.syncORMs.path) {
    setSyncORMs({
      ids: data.syncORMs.ids,
      path: data.syncORMs.path,
    });
  }
  return true;
};
</script>

<style lang="scss">
.edit-field-tool-tip {
  top: 15px;
}
</style>