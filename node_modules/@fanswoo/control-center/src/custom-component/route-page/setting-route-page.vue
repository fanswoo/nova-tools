<template>
  <div class="body-content-page">
    <PageNavigation
      :title="title"
      :subtitle="subtitle"
      :activeName="pageNavigation.activeName"
      :showFixedPageNavigation="pageNavigation.showFixedPageNavigation"
      :navItems="pageNavigation.navItems"
    />
    <div class="edit-content">
      <template v-for="(Form, key) in Forms" :key="key">
        <form class="edit-form" method="post" :action="Form.action">
          <!--          <input type="hidden" name="_token" :value="csrf" />-->
          <template v-for="(field, key2) in Form.fields" :key="key2">
            <component :is="field.type" v-bind="field"/>
          </template>
          <div
            v-if="Form.submits && Form.submits.length > 0"
            class="line-submit"
          >
            <div class="field">
              <template v-for="(submit, key2) in Form.submits" :key="key2">
                <button
                  type="submit"
                  :class="'btn' + ' ' + 'btn-lg' + ' ' + submit.styleClass"
                  :name="submit.inputName"
                  :ff-action="submit.action"
                  :ff-confirm="submit.confirm"
                >
                  {{ submit.buttonText }}
                </button
                >&nbsp;
              </template>
            </div>
          </div>
        </form>
      </template>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, inject, getCurrentInstance } from 'vue';
import _ from 'lodash';
import CustomRoutePage from '@fanswoo/control-center/core/custom-route-page.vue';
import PageNavigation from '@fanswoo/control-center/layouts/page-navigation.vue';
import { ComponentLoader } from '@fanswoo/component-loader/main';

// Define props
const props = defineProps({
  title: {
    type: String,
    default: '',
  },
  subtitle: {
    type: String,
    default: '',
  },
  Forms: {
    type: Object,
    default: () => ({}),
  },
  pageNavigation: {
    type: Object,
    default: () => ({}),
  },
});

// Injects
const urlRootPath = inject('urlRootPath');

// Component state
const csrf = ref('');

// Lifecycle onMounted equivalent
const vueInstance = getCurrentInstance();
const Loader = ComponentLoader.getInstance();
const components = Loader.loadComponents([
  {
    pageName: urlRootPath,
    themeName: 'settingCustomComponent',
    typeName: 'lineContent',
  },
  {
    pageName: urlRootPath,
    themeName: 'layout',
    typeName: 'layout',
  },
]);

if(!vueInstance.proxy.$.components) {
  vueInstance.proxy.$.components = [];
}
_.merge(vueInstance.proxy.$.components, components);

csrf.value =
  document
    .querySelector('meta[name="csrf-token"]')!
    .getAttribute('content') || '';
</script>

