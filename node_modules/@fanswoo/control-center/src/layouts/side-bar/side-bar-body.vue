<template>
  <div>
    <template v-for="(child1, key) in adminSidebox" :key="key">
      <div
        :class="{
          sidebox: true,
          hover: child1.selected && child1.selected === true,
        }"
      >
        <div class="title-box">
          <FontAwesomeIcon
            class="icon-box"
            :icon="child1.icon"
          />
          <h2>{{ child1.title }}</h2>
        </div>
        <div class="scrollbar">
          <template v-for="(child2, key2) in child1.child" :key="key2">
            <div
              :class="{
                'admin-header-father-area': true,
                hover: child2.selected,
              }"
            >
              <h3
                class="admin-header-father-area-arrow"
                @click="onClickAdminHeaderFatherAreaArrow($event)"
              >
                <div class="arrow">
                  <FontAwesomeIcon icon="chevron-right"/>
                </div>
                {{ child2.title }}
              </h3>
              <div class="child-area">
                <template
                  v-for="(link, key3) in getChildArea(child2.child, key, key2)" :key="key3"
                >
                  <a
                    v-if="link.href"
                    :href="link.href"
                    :class="{
                      'ac-href-small': true,
                      hidden: link.hidden,
                    }"
                    target="_blank"
                  >
                    {{ link.title }}
                  </a>
                  <router-link
                    v-else
                    :to="link.to"
                    :class="{
                      'ac-href-small': true,
                      selected: link.selected,
                      hover: link.selected,
                      hidden: link.hidden,
                    }"
                  >
                    {{ link.title }}
                  </router-link>
                </template>
              </div>
            </div>
          </template>
        </div>
      </div>
    </template>
  </div>
</template>

<script setup lang="ts">
import { defineComponent, reactive, ref, provide, inject, getCurrentInstance } from 'vue';
import { useStore } from '@/control-center/store/control-center-store';

interface Link {
  href?: string;
  to?: string;
  title: string;
  hidden: boolean;
  selected: boolean;
}

const urlRootPath = inject<string>('urlRootPath');
const adminSidebox = inject('adminSidebox');
const sidebarDefaultImgSrc = inject<string | number>('sidebarDefaultImgSrc');

const onClickAdminHeaderFatherAreaArrow = (event: Event) => {
  const $adminHeaderFatherArea = $(event.currentTarget).parent('.admin-header-father-area');
  if ($adminHeaderFatherArea.hasClass('hover')) {
    $adminHeaderFatherArea.removeClass('hover');
  } else {
    $('.side-bar .admin-header-father-area').removeClass('hover');
    $adminHeaderFatherArea.addClass('hover');
  }
};

const getChildArea = (child: any, key: any, key2: any): Link[] => {
  const links: Link[] = [];
  Object.keys(child).forEach((key3) => {
    const child3 = child[key3];
    if (child3.controller) {
      Object.keys(child3.controller).forEach((key4) => {
        const controller = child3.controller[key4];
        const link: Link = {
          title: controller.title,
          hidden: controller.hidden,
          selected: controller.selected,
        };
        if (controller.href) {
          link.href = controller.href;
        } else {
          link.to = `/${urlRootPath.value}/${key}/${key2}/${key3}/${key4}`;
        }
        links.push(link);
      });
    }
  });
  return links;
};
</script>
