<template>
  <div class="page-navigation">
    <h3 class="title">
      <FontAwesomeIcon
        v-if="!skipMenu"
        v-show="showMenu"
        class="menu"
        icon="bars"
        @click="onMenuClick"
      />
      <slot name="title"
        >{{ title || childTitle2 }}
        <template v-if="subtitle"> - {{ subtitle }}</template>
        <template v-else-if="childTitle4"> - {{ childTitle4 }}</template>
      </slot>
    </h3>
    <slot>
      <b-nav v-if="navItems" tabs>
        <template v-for="(navItem, key) of navItems" :key="key">
          <li
            v-if="navItem.to"
            class="nav-item"
            :disabled="navItem.disabled"
          >
            <router-link
              :to="navItem.to"
              :class="{
                'nav-link': true,
                active: navItem.active,
              }"
            >
              {{ navItem.name }}
            </router-link>
          </li>
          <b-nav-item
            v-else
            :disabled="navItem.disabled"
            :active="navItem.active"
            >{{ navItem.name }}</b-nav-item
          >
        </template>
      </b-nav>
      <b-dropdown
        v-if="navItems && navItems.length > 0"
        ref="pageNavigationFixed"
        right
        :text="activeName"
        variant="primary"
        class="page-navigation-fixed"
      >
        <template v-for="(navItem, key) of navItems" :key="key">
          <b-dropdown-text
            v-if="navItem.active"
            :disabled="navItem.disabled"
            :active="navItem.active"
            >{{ navItem.name }}</b-dropdown-text
          >
          <b-dropdown-item
            v-else
            :disabled="navItem.disabled"
            :active="navItem.active"
          >
            <slot>
              <router-link v-if="navItem.to" :to="navItem.to">
                {{ navItem.name }}
              </router-link>
              <template v-else>
                {{ navItem.name }}
              </template>
            </slot>
          </b-dropdown-item>
        </template>
      </b-dropdown>
    </slot>
  </div>
</template>

<script setup lang="ts">
import { onMounted, onUnmounted, ref, computed } from 'vue';
import { useStore } from '@/control-center/store/control-center-store';

// Define props
const props = defineProps({
  skipMenu: {
    type: Boolean,
    default: false,
  },
  childTitle2: {
    type: String,
    default: '',
  },
  childTitle4: {
    type: String,
    default: '',
  },
  title: {
    type: String,
    default: '',
  },
  subtitle: {
    type: String,
    default: '',
  },
  activeName: {
    type: String,
    default: '',
  },
  navItems: {
    type: Array,
    default: () => [],
  },
});

const windowWidth = ref(0);

const store = useStore();
const sidebarOpened = computed(() => store.state.RoutePage.sidebarOpened);

const showMenu = computed(() => {
  return !sidebarOpened.value && windowWidth.value >= 768;
});

const setSidebarOpened = (value) => {
  store.commit('RoutePage/setSidebarOpened', value);
};

const onWindowResize = () => {
  windowWidth.value = $(window).width();
};

onMounted(() => {
  windowWidth.value = $(window).width();
  window.addEventListener('resize', onWindowResize);

  // Additional warnings as in the original component
  if (props.childTitle2) {
    console.warn(
      `<PageNavigation> doesn't support 'childTitle2' props, please use 'title' replace 'childTitle2'`,
    );
  }

  if (props.childTitle4) {
    console.warn(
      `<PageNavigation> doesn't support 'childTitle4' props, please use 'subtitle' replace 'childTitle4'`,
    );
  }
});

onUnmounted(() => {
  window.removeEventListener('resize', onWindowResize);
});

// Additional functions for menu click handling
const onMenuClick = () => {
  setSidebarOpened(!sidebarOpened.value);
};
</script>

<style lang="scss" scoped>
@import '@fanswoo/core/style/modules/boot.scss';

body {
  .wrap {
    .body-content {
      .page-navigation {
        display: flex;
        position: sticky;
        top: 0;
        z-index: 1004;
        background: #fff;
        height: 50px;
        border-bottom: 1px solid #eee;
        @include media-down(sm) {
          top: 50px;
        }
        h3 {
          line-height: 50px;
          font-size: 14px;
          font-weight: 500;
          padding-left: 10px;
          margin-right: 10px;
          overflow: hidden;
          .menu {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin-right: 5px;
            vertical-align: -4px;
          }
        }
        .nav-tabs {
          margin: 0 10px;
          height: 50px;
          border: none;
          .nav-item {
            padding-top: 10px;
            margin-right: 5px;
            display: block;
            @include media-down(sm) {
              display: none;
            }
            .nav-link.active {
              // &:hover, &:focus {
              //     background: #F5F5F5;
              //     border-color: #F5F5F5;
              //     color: #555;
              // }
              // @include media-down(md) {
              border-radius: 0.25rem;
              border-color: #dee2e6;
              // }
            }
          }
        }
        .page-navigation-fixed {
          position: absolute;
          right: 10px;
          top: 10px;
          // z-index: 2;
          display: none;
          @include media-down(sm) {
            display: block;
          }
          .btn {
            background: none;
            color: #333;
            font-weight: 700;
            &:focus {
              box-shadow: none;
            }
          }
          .b-dropdown-text {
            background: #eee;
            font-weight: 700;
          }
        }
      }
    }
  }
}
</style>
